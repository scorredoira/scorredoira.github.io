(function(){window.S={};S.each=function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c])};S.get=function(a){"string"==typeof a&&(a=document.getElementById(a));return a};S.disableTextSelect=function(a){a.onselectstart=function(b){b.preventDefault?b.preventDefault():event.returnValue=!1;return!1};"undefined"!=typeof a.style.MozUserSelect&&(a.style.MozUserSelect="none")};S.clearChildNodes=function(a){for("string"==typeof a&&(a=document.getElementById(a));a.hasChildNodes();)S.detach&&S.detach(a.firstChild,
"blur"),a.removeChild(a.firstChild)};S.parentNode=function(a){return a.parentElement||a.parentNode};S.removeNode=function(a){null!=a&&null!=S.parentNode(a)&&(S.detach&&S.detach(a,"blur"),S.parentNode(a).removeChild(a))};S.getSize=function(a){a=S.get(a);return{width:a.offsetWidth,height:a.offsetHeight}};S.create=function(a,b,c,d,f){a=document.createElement(a);b&&(a.id=b);c&&(a.className=c);d&&d.appendChild(a);null!==f&&S.setText(a,f);return a};S.getCaretPosition=function(a){if(document.selection){a.focus();
var b=document.selection.createRange();b.moveStart("character",-a.value.length);return b.text.length}return"number"===typeof a.selectionStart?a.selectionStart:0};S.getMouseCoords=function(a,b){var c=0,d=0,f=b;do c+=f.offsetLeft-f.scrollLeft,d+=f.offsetTop-f.scrollTop,f=f.offsetParent;while(f);return{x:a.pageX-c-document.body.scrollLeft,y:a.pageY-d-document.body.scrollTop}};S.setText=function(a,b){null==b&&(b="");a=S.get(a);a.innerText?a.innerText=b:a.textContent=b};S.attach=function(a,b,c,d){a.addEventListener?
a.addEventListener(b,c,d):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c};S.stopBubble=function(a){a||(a=window.event);S.isDefined(a.preventDefault)?a.preventDefault():a.returnValue=!1}})();(function(){S.grid=function(a){var b=this;this.container=S.get(a);this.panel=this.values=this.columns=null;this.totalRows=0;this.setOddRowStyle=!1;this.focusBorder=null;this.shortcuts=[];var c=!1;this.getCell=function(a,c){if(b.columns.length<=c)return null;var e=b.rows;if(e.length<=a)return null;e=e[a];return null==e?null:e.cells[c]};this.visibleRowCount=function(){return parseInt(b.globalPanelSize.height/b.columnHeight)};this.setPageSize=function(a){var c=b.visibleRowCount(),e=a-1;0>e&&(e=0);var i=
0<b.totalRows?b.totalRows:b.values?b.values.length:0,a=a+c+1;0<i&&a>i&&(a=i);b.renderPageSize={start:e,end:a}};this.reload=function(){b.clear();b.totalRows=0;b.update()};this.update=function(a){c||(b.build(),b.initMouseEvents&&b.initMouseEvents(),b.initEditEvents&&b.initEditEvents(),c=!0);a=a||0;b.setPageSize(a);b.totalRows=0<b.totalRows?b.totalRows:b.values?b.values.length:0;0<b.totalRows?(b.buildRows(a||0),b.setFocus(0,0)):b.clear()};this.onScrollPanel=function(){var a=b.wrapper.scrollLeft,c=b.wrapper.scrollTop;
0<Math.abs(a-b.lastScrollLeft)&&(b.headerPanel.style.left=-1*a+"px");if(0<Math.abs(c-b.lastScrollTop)){var e=parseInt(b.wrapper.scrollTop/b.columnHeight);b.update(e)}b.lastScrollLeft=a;b.lastScrollTop=c};this.isRowInMemory=function(a){var c=b.values;return null==c||c.length<=a||null==c[a]?!1:!0};this.isRowRendered=function(a){return b.rows.length<=a||null==b.rows[a]?!1:!0};this.clear=function(){b.panel&&S.clearChildNodes(b.panel);b.rows=[]};this.setValue=function(a,c){a.value=c;S.setText(a.element,
c);b.values[a.rowIndex][a.columnIndex]=c};this.getCellAtEvent=function(a){var c=S.getMouseCoords(a,b.panel),a=Math.floor(c.y/b.columnHeight);a:{for(var e=b.columns,i=b.numbersColumnWidth,h=e.length-1;0<=h;h--)if(c.x>e[h].left+i){c=h;break a}c=-1}return b.getCell(a,c)}}})();(function(){function a(a,c,d,f,e,i){var h=a.columns[f],g="cell";a.setOddRowStyle&&0==d%2&&(g+=" odd");e=S.create("div",null,g,e,c);e.style.width=h.width+1+"px";e.style.height=a.columnHeight+1+"px";e.style.left=h.left+a.numbersColumnWidth+i+"px";e.style.top=d*a.columnHeight+"px";e.tabIndex=0;return{value:c,rowIndex:d,columnIndex:f,element:e,grid:a}}S.grid.prototype.build=function(){this.columnHeight=25;this.numbersColumnWidth=50;this.columnsWidth=0;var b=this.columns.length;this.globalPanelSize=null;
this.rows=[];var c=document.createElement("div"),d=document.createElement("div"),f=document.createElement("div"),e=document.createElement("div");this.headerPanel=d;this.panel=e;this.wrapper=f;this.globalPanel=c;for(var i=0,h=0;h<this.columns.length;h++){var g=this.columns[h];"string"==typeof g&&(g={text:g},this.columns[h]=g);g.width||(g.width=100);g.left=i;i+=g.width;this.columnsWidth+=g.width}c.className="globalPanel";c.tabIndex=-1;S.clearChildNodes(this.container);this.container.appendChild(c);
d.tabIndex=-1;d.className="headerRow";d.style.height=this.columnHeight+"px";i=document.createElement("div");i.className="headerRowInner";i.style.height=this.columnHeight+"px";d.appendChild(i);for(h=0;h<b;h++)a(this,this.columns[h].text,0,h,i,0).element.className+=" header";c.appendChild(d);f.className="gridWrapper";f.style.left="0px";f.style.top=this.columnHeight+"px";this.globalPanelSize=S.getSize(c);f.style.width=this.globalPanelSize.width+"px";f.style.height=this.globalPanelSize.height-this.columnHeight+
"px";f.onscroll=this.onScrollPanel;e.className="grid";e.tabIndex=-1;f.appendChild(e);S.disableTextSelect(f);c.appendChild(f);S.disableTextSelect(c)};S.grid.prototype.buildRows=function(){function b(a){c.panel.removeChild(a.numCell.element);a.numCell.element=null;for(var a=a.cells,b=a.length-1;0<=b;b--)c.panel.removeChild(a[b].element)}var c=this;c.panel.style.width=c.columnsWidth+c.numbersColumnWidth+1+"px";c.panel.style.height=c.totalRows*c.columnHeight+1+"px";for(var d=c.values,f=c.columns,e=c.renderPageSize,
i=e.start,e=e.end,h=c.rows,g=i;g<e;g++)if(!c.isRowRendered(g)){var l=g,k;k=l;var j=S.create("div",null,"cell rowNumber",c.panel,k+1);j.style.width=c.numbersColumnWidth+"px";j.style.height=c.columnHeight+"px";j.style.left="0px";j.style.top=k*c.columnHeight+"px";k={element:j,rowIndex:k};for(var j=[],p=d[l],m=0,q=f.length;m<q;m++){var n=a(c,p[m],l,m,c.panel,0);c.initCellKeyboardEvents(n);j.push(n)}c.rows[l]={numCell:k,cells:j}}for(g=i-1;0<=g;g--)d=h[g],null!=d&&(b(d),h[g]=null);for(g=h.length-1;g>=e;g--)d=
h[g],null!=d&&(b(d),h[g]=null)}})();(function(){S.grid.prototype.initEditEvents=function(){var a=this;S.attach(a.panel,"click",function(b){var c=a.getCellAtEvent(b);null!=c&&a.startEdit(b,c)})};S.grid.prototype.startEdit=function(a,b){var c=this;null!=c.editingCell&&c.endEdit();c.editingCell=b;var d;d=document.createElement("input");d.type="text";d.className="gridEditor";d.onblur=function(){c.endEdit()};d.onkeydown=function(a){switch(a.keyCode){case 13:case 40:c.endEdit();b.rowIndex<c.rows.length&&c.setFocus(b.rowIndex+1,b.columnIndex);
S.stopBubble(a);break;case 9:a.preventDefault();a.stopPropagation();c.endEdit();b.columnIndex<c.columns.length&&c.setFocus(b.rowIndex,b.columnIndex+1);break;case 38:c.endEdit();0<b.rowIndex&&c.setFocus(b.rowIndex-1,b.columnIndex);S.stopBubble(a);break;case 37:if(0<b.columnIndex){var e=S.getCaretPosition(d);0>=e&&(c.endEdit(),0<b.columnIndex&&c.setFocus(b.rowIndex,b.columnIndex-1),S.stopBubble(a))}break;case 39:e=S.getCaretPosition(d),e>=d.value.length&&(c.endEdit(),b.columnIndex<c.columns.length&&
c.setFocus(b.rowIndex,b.columnIndex+1),S.stopBubble(a))}};d.onclick=function(a){a.stopPropagation()};var f=d,e=b.element;f.style.top=e.offsetTop+2+"px";f.style.left=e.offsetLeft+2+"px";f.style.width=e.offsetWidth-4+"px";f.style.height=e.offsetHeight-4+"px";c.wrapper.appendChild(d);b.value&&(d.value=b.value,d.select());d.focus();S.grid.prototype.endEdit=function(){var a=c.editingCell;if(null!=a){c.editingCell=null;var b=a.value||null,e=d.value;if(b!=e&&(c.setValue(a,e),c.onCellChanged))c.onCellChanged(e,
b,a);S.removeNode(d);d=null}}}})();(function(){S.grid.prototype.setFocus=function(a,b){null==this.focusBorder?(this.focusBorder=document.createElement("div"),this.focusBorder.className="focus",this.panel.appendChild(this.focusBorder)):null==this.focusBorder.parentNode&&this.panel.appendChild(this.focusBorder);a>=this.rows.length&&(a=this.rows.length-1);b>=this.columns.length&&(b=this.columns.length-1);var c=this.getCell(a,b);if(null!=c){var d=c.element,f=this.focusBorder;f.style.top=d.style.top;f.style.left=d.style.left;f.style.width=
d.style.width;f.style.height=d.style.height;c.element.focus()}}})();(function(){S.grid.prototype.initKeyboardEvents=function(){var a=this;S.each(a.rows,function(b){b&&S.each(b,function(b){a.initCellKeyboardEvents(b)})})};S.grid.prototype.initCellKeyboardEvents=function(a){a.element.onkeydown=function(b){switch(b.keyCode){case 38:0<a.rowIndex&&grid.setFocus(a.rowIndex-1,a.columnIndex);S.stopBubble(b);break;case 40:case 13:a.rowIndex<grid.rows.length&&grid.setFocus(a.rowIndex+1,a.columnIndex);S.stopBubble(b);break;case 37:0<a.columnIndex&&grid.setFocus(a.rowIndex,a.columnIndex-
1);S.stopBubble(b);break;case 39:case 9:a.columnIndex<grid.columns.length&&grid.setFocus(a.rowIndex,a.columnIndex+1);S.stopBubble(b);break;case 17:case 18:case 16:break;case 46:grid.setValue(a,null);S.stopBubble(b);break;default:grid.startEdit(b,a)}}}})();(function(){S.grid.prototype.initMouseEvents=function(){var a=this;S.attach(a.panel,"mousedown",function(b){b=a.getCellAtEvent(b);null!=b&&a.setFocus(b.rowIndex,b.columnIndex)})}})();
